<!DOCTYPE html>
<html>
<head>
    <title>Create Admin User</title>
    <script type="module">
        // Import Firebase modules
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getDatabase, ref, set } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js';

        // Your Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyBqqzBvRTWrt1iNpvnmPtKXpNyBoVUsvLc",
            authDomain: "encg-barakat.firebaseapp.com",
            databaseURL: "https://encg-barakat-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "encg-barakat",
            storageBucket: "encg-barakat.firebasestorage.app",
            messagingSenderId: "686929536837",
            appId: "1:686929536837:web:99da8228c9d4836975c02c"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Hash password function (same as your app)
        async function hashPassword(password) {
            if (!password) return '';
            
            const msgUint8 = new TextEncoder().encode(password); 
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgUint8);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            
            return hashHex;
        }

        // Create admin user function
        window.createAdmin = async function() {
            const username = document.getElementById('username').value || 'admin';
            const password = document.getElementById('password').value || 'test1234';
            
            if (!username || !password) {
                alert('Please enter username and password');
                return;
            }

            try {
                const hashedPassword = await hashPassword(password);
                const userId = `admin_${Date.now()}`;
                
                const adminData = {
                    username: username,
                    hashed_password: hashedPassword,
                    role: "admin",
                    isActive: true
                };

                // Set in login_credentials
                const credentialsRef = ref(database, `login_credentials/${userId}`);
                await set(credentialsRef, adminData);

                // Set in users
                const userRef = ref(database, `users/${userId}`);
                await set(userRef, {
                    ...adminData,
                    createdAt: new Date().toISOString()
                });

                document.getElementById('result').innerHTML = `
                    <div style="color: green; padding: 10px; border: 1px solid green; border-radius: 5px;">
                        ✅ Admin user created successfully!<br>
                        Username: <strong>${username}</strong><br>
                        Password: <strong>${password}</strong><br>
                        User ID: ${userId}
                    </div>
                `;
                
            } catch (error) {
                document.getElementById('result').innerHTML = `
                    <div style="color: red; padding: 10px; border: 1px solid red; border-radius: 5px;">
                        ❌ Error: ${error.message}
                    </div>
                `;
            }
        };
    </script>
</head>
<body style="font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px;">
    <h1>Create Admin User</h1>
    <p><strong>Important:</strong> Update the Firebase config in this file first!</p>
    
    <div style="margin: 20px 0;">
        <label>Username:</label><br>
        <input type="text" id="username" value="admin" style="width: 100%; padding: 8px; margin: 5px 0;">
    </div>
    
    <div style="margin: 20px 0;">
        <label>Password:</label><br>
        <input type="password" id="password" value="test1234" style="width: 100%; padding: 8px; margin: 5px 0;">
    </div>
    
    <button onclick="createAdmin()" style="background: #3f51b5; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">
        Create Admin User
    </button>
    
    <div id="result" style="margin-top: 20px;"></div>
    
    <div style="margin-top: 30px; padding: 15px; background: #f5f5f5; border-radius: 5px;">
        <h3>Instructions:</h3>
        <ol>
            <li>Update the Firebase config in this file with your actual values</li>
            <li>Make sure Anonymous authentication is enabled in Firebase Console</li>
            <li>Enter your desired username and password</li>
            <li>Click "Create Admin User"</li>
            <li>Use the credentials to login to your app</li>
        </ol>
    </div>
</body>
</html>